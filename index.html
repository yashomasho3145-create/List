{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-webhook",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        280,
        1357
      ],
      "id": "2fbe58a4-4499-4a96-a933-8e25fe0e420e",
      "name": "Webhook",
      "webhookId": "52d32775-a371-4acd-a253-58387bf26dcc"
    },
    {
      "parameters": {
        "jsCode": "// LINE webhook Ê≠£Ë¶èÂåñÔºö{ user_id, text, replyToken, body }\nconst raw = $json.body ?? $json;\nlet payload;\nif (typeof raw === 'string') {\n  try { payload = JSON.parse(raw); } catch { payload = {}; }\n} else {\n  payload = raw || {};\n}\nconst ev = (payload.events && payload.events[0]) || {};\nconst src = ev.source || {};\nconst msg = ev.message || {};\nconst text = (msg.type === 'text' ? (msg.text || '') : '').trim();\nconst replyToken = ev.replyToken || '';\nreturn [{ json: { user_id: src.userId || '', text, replyToken, body: payload } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        500,
        1520
      ],
      "id": "e6683b67-27f7-40b9-ac47-99cba464a50e",
      "name": "Code - Normalize LINE"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f4628f88-a2cd-481f-9bc1-824f2b987f40",
              "name": "text",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        1520
      ],
      "id": "dabd7394-0418-476e-9cf9-fd8005c0ae87",
      "name": "Set Agent Input"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„É™„Çπ„Éà",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e4b7c548-906b-4528-a0db-f24d20ca3622"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "List"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e0194044-848b-4e99-8997-a10219319c18",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„Çπ„ÉÜ„Éº„Çø„Çπ",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Status"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1c1335f6-ca5b-4940-92e6-018673c094a6",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„Ç∏„É£„Éº„Éä„É´",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Journal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cd335660-5e4b-4b24-b1f0-3bd7d441a18e",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "Â§©Ê∞ó",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Wether"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5c243a96-35fe-4a8a-ab3f-ccfd7a6a49d6",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„Éã„É•„Éº„Çπ",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "News"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e6a4f791-6790-4bec-af1a-6eb7e6bc492f",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„É†„Ç≠„É†„Ç≠",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Muscle"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6d7893a5-dde9-4381-b8dd-caec4fca73ed",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "„Ç´„É¨„É≥„ÉÄ„Éº",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "calendar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e8f04826-8443-45f3-a12c-3598b0c4a6b1",
                    "leftValue": "={{ $('Webhook').item.json.body.events[0].message.text }}",
                    "rightValue": "ÂÆå‰∫Üüëç",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Á≠ã„Éà„É¨ÂÆå‰∫Ü"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": false
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        940,
        1394
      ],
      "id": "5e2363dc-b9d4-4d3e-be09-091827db8d43",
      "name": "Switch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"„É™„Çπ„Éà„ÅØ„Åì„Å°„Çâ„Åã„Çâüëá\"\n  },\n  {\n    \"type\": \"text\",\n    \"text\": \"https://liff.line.me/2008372898-2q9qWmxv\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"uri\",\n            \"label\": \"„É™„Çπ„Éà\",\n            \"uri\": \"https://liff.line.me/2008372898-2q9qWmxv\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1238,
        620
      ],
      "id": "23685fea-62f0-40ee-9899-b8cfc7580810",
      "name": "List"
    },
    {
      "parameters": {
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            },
            {
              "fieldId": "task_name",
              "fieldValue": "={{ $json.text }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1238,
        2620
      ],
      "id": "ea5bc3b9-324d-42c2-8862-e8486eac5dea",
      "name": "Create a row",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "path": "list",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "999ec68f-bbd9-4b34-9fa6-6d8b0fa0a068",
      "name": "Webhook - LIST (GET)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        280,
        5490
      ],
      "webhookId": "8a0b0109-e196-4ff8-ba47-ee625631d618"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.query.user_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        500,
        5490
      ],
      "name": "Supabase: Select rows1",
      "id": "c83cde5f-e4dd-47a8-a5a7-c38d12c592a8",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const rows = Array.isArray(items) ? items.map(i => i.json) : [];\n\nconst toTask = r => ({\n  id: r.id,\n  title: r.task_name || '(ÁÑ°È°å)',\n  pinned: Boolean(r.pinned),\n  priority: r.priority ?? 0,\n  vision_score: r.vision_score ?? 0,\n  excite_score: r.excite_score ?? 0,\n  growth_score: r.growth_score ?? 0,\n  complete_at: Number(r.complete_at) || 0,\n  sort_order: Number(r.sort_order) ?? 99999,\n  remind_at: r.remind_at || null, \n});\n\n// ÂàÜÈ°û\nconst pinned = [];\nconst active = [];\nconst completed = [];\n\nfor (const r of rows) {\n  const t = toTask(r);\n\n  if (t.pinned) {\n    pinned.push(t);\n  } else if (t.complete_at === 1) {\n    completed.push(t);\n  } else {\n    active.push(t);\n  }\n}\n\n// sort_order „Åå„ÅÇ„Çå„Å∞„Åù„Çå„Åß‰∏¶„Å≥Êõø„Åà\nconst bySort = (a, b) => (a.sort_order ?? 99999) - (b.sort_order ?? 99999);\n\npinned.sort(bySort);\nactive.sort(bySort);\ncompleted.sort(bySort);\n\nreturn [{ json: { pinned, active, completed } }];\n"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        720,
        5490
      ],
      "name": "Adapt ‚Üí {pinned,active,completed}1",
      "id": "f27dc641-607d-4db6-ae0a-859ed9c1b6fc"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        940,
        5490
      ],
      "name": "Respond JSON1",
      "id": "72dea05a-526d-4c06-975a-769152b79992"
    },
    {
      "parameters": {
        "content": "„É°„ÉÉ„Çª„Éº„Ç∏„Çí„Ç≠„É£„ÉÉ„ÉÅ\n‚Üì\n„ÉªListË°®Á§∫\n„ÉªStatusË°®Á§∫\n„ÉªJournalË°®Á§∫\n„Éªsupabase„Å´„Çø„Çπ„ÇØ‰øùÂ≠ò",
        "height": 2220,
        "width": 1892
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        122,
        560
      ],
      "typeVersion": 1,
      "id": "08cc3268-6916-4ded-8116-2238b4d13f65",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "supabase - LIFF(List)„Å´ÂèçÊò†\n„Éª„ÄåÊõ¥Êñ∞„ÄçÔºà„É™„Éï„É¨„ÉÉ„Ç∑„É•Ôºâ",
        "height": 216,
        "width": 1096
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        122,
        5434
      ],
      "typeVersion": 1,
      "id": "41e6eac6-9eda-4dcf-97bd-b060d4693ae1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "LIFF(List)„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥ - supabaseÂèçÊò†\n‚Üì\n„ÉªÂÆå‰∫Ü\n„Éª„É™„Éû„Ç§„É≥„Éâ\n„Éª„Éî„É≥\n„ÉªÂâäÈô§",
        "height": 2496,
        "width": 2244
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        138,
        2894
      ],
      "typeVersion": 1,
      "id": "a60317b8-7c2a-491b-a5e1-9772541c1a08",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"„Ç∏„É£„Éº„Éä„É´„ÅØ„Åì„Å°„Çâ„Åã„Çâüëá\"\n  },\n  {\n    \"type\": \"text\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"uri\",\n            \"label\": \"„Ç∏„É£„Éº„Éä„É´\",\n            \"uri\": \"https://liff.line.me/2008372898-2q9qWmxv\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1238,
        1020
      ],
      "id": "b8f53ccd-4e4c-4a74-806f-071ed2ebcb47",
      "name": "Journal"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "LINE„É¶„Éº„Ç∂„ÉºID‰∏ÄË¶ß",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.body.events[0].source.userId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        500,
        1194
      ],
      "id": "af36b4ce-7e8e-4d7a-9118-56d63d516d19",
      "name": "Supabase Check User",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "191e0572-e64a-4e35-8485-08c4660e52c7",
              "leftValue": "={{ $json.user_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        720,
        1194
      ],
      "id": "ee349eef-fe3c-4b55-bb2e-b78f7a693b7e",
      "name": "If New User?"
    },
    {
      "parameters": {
        "tableId": "LINE„É¶„Éº„Ç∂„ÉºID‰∏ÄË¶ß",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('Webhook').item.json.body.events[0].source.userId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        940,
        1194
      ],
      "id": "7944b13d-47af-4402-ab99-c5746560af68",
      "name": "Supabase Create User",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "content": "ÂÆöÂàª„Å´‰∏ÄÊñâÈÄÅ‰ø°",
        "height": 788,
        "width": 1948
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        120,
        5720
      ],
      "typeVersion": 1,
      "id": "84a31f55-55df-4199-859a-56048e39a816",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "functionCode": "// Ë§áÊï∞„ÅÆÂêçË®Ä„Åã„Çâ„É©„É≥„ÉÄ„É†„Åß1‰ª∂„ÇíÈÅ∏Êäû\n// items „ÅØ [{json: {...}}, {json: {...}}, ...] „ÅÆÂΩ¢\nif (!items.length) {\n  return [];\n}\nconst picked = items[Math.floor(Math.random() * items.length)];\n// 1‰ª∂„Å†„Åë„ÇíËøî„Åô\nreturn [picked];"
      },
      "id": "01b20ce9-d6f4-446a-9a6f-3d30fdf5f224",
      "name": "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        720,
        5750
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "ÂêçË®ÄÈõÜ",
        "filters": {
          "conditions": [
            {
              "keyName": "sent_at",
              "condition": "eq",
              "keyValue": "0"
            }
          ]
        }
      },
      "id": "aa0d1ed3-7d66-4746-bec9-9b1c87bace5e",
      "name": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        500,
        5750
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "LINE„É¶„Éº„Ç∂„ÉºID‰∏ÄË¶ß"
      },
      "id": "78a9ff15-b586-4353-909f-27815b4ddee1",
      "name": "LINE„É¶„Éº„Ç∂„Éº‰∏ÄË¶ßÂèñÂæó1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        940,
        5950
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "ÂêçË®ÄÈõÜ",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sent_at",
              "fieldValue": "1"
            }
          ]
        }
      },
      "id": "bd09b60a-c246-4503-a244-f8052df02491",
      "name": "ÂêçË®Ä„ÇíÈÄÅ‰ø°Ê∏à„Åø„Å´Êõ¥Êñ∞1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        940,
        5750
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "hour": 22,
              "minute": 30
            }
          ]
        }
      },
      "id": "69e0475d-3f9f-444d-895a-5dcdb522e6bb",
      "name": "Cron - ÊØéÊó•22:30",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        280,
        5850
      ]
    },
    {
      "parameters": {
        "functionCode": "// ÂêçË®Ä„Å®„É¶„Éº„Ç∂„Éº„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„ÇãÔºà‰ªñ„Éé„Éº„Éâ„ÅÆÂá∫Âäõ„ÇíÁõ¥Êé•ÂèÇÁÖß„Åô„ÇãÁâàÔºâ\n\n// „ÄåÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû„Äç„Éé„Éº„Éâ„ÅÆÂá∫ÂäõÔºà1‰ª∂„Å†„ÅëÊÉ≥ÂÆöÔºâ\nconst quoteItems = $items(\"ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû\");\nif (!quoteItems.length) {\n  return [];\n}\nconst quote = quoteItems[0].json; // { kakugen, jinbutsu, id, ... }\n\n// „ÄåLINE„É¶„Éº„Ç∂„Éº‰∏ÄË¶ßÂèñÂæó1„Äç„Éé„Éº„Éâ„ÅÆÂá∫ÂäõÔºàË§áÊï∞‰ª∂Ôºâ\nconst userItems = $items(\"LINE„É¶„Éº„Ç∂„Éº‰∏ÄË¶ßÂèñÂæó1\");\nif (!userItems.length) {\n  return [];\n}\n\n// user_id „ÅåÂÖ•„Å£„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº„Å†„Åë„Å´Áµû„Çã\nconst validUsers = userItems.filter(item => {\n  const id = item.json.user_id;\n  return typeof id === \"string\" && id.trim() !== \"\";\n});\n\n// Ë™∞„ÇÇ„ÅÑ„Å™„Åë„Çå„Å∞ÁµÇ‰∫Ü\nif (!validUsers.length) {\n  return [];\n}\n\n// ÂêÑ„É¶„Éº„Ç∂„Éº„Åî„Å®„Å´1„Ç¢„Ç§„ÉÜ„É†ÁîüÊàê\nreturn validUsers.map(item => ({\n  json: {\n    to: item.json.user_id,    // LINE„ÅÆ„É¶„Éº„Ç∂„ÉºID\n    kakugen: quote.kakugen,   // ÂêçË®Ä\n    jinbutsu: quote.jinbutsu, // ‰∫∫Áâ©Âêç\n    id: quote.id              // ÂêçË®ÄIDÔºàÊõ¥Êñ∞Áî®Ôºâ\n  }\n}));\n"
      },
      "id": "2533721a-763a-47d9-bc7a-d86934729835",
      "name": "„É¶„Éº„Ç∂„Éº√óÂêçË®Ä ÁµêÂêà3",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1160,
        5950
      ]
    },
    {
      "parameters": {
        "content": "LINE„ÅÆ„É¶„Éº„Ç∂„ÉºID„Çísupabase„Å´‰øùÂ≠ò",
        "height": 200,
        "width": 540,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        500,
        1154
      ],
      "typeVersion": 1,
      "id": "cd688e4a-3494-4543-b102-ea1337ff93c7",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "text": "={{ $json.text }}",
        "additionalFields": {}
      },
      "id": "359156f9-b693-4d75-9cd7-2e96a5b42aab",
      "name": "Create Tweet2",
      "type": "n8n-nodes-base.twitter",
      "position": [
        1600,
        5900
      ],
      "typeVersion": 2,
      "credentials": {
        "twitterOAuth2Api": {
          "id": "Yjbn7uiOysu8FUed",
          "name": "X account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://weather.tsukumijima.net/api/forecast/city/170010",
        "options": {}
      },
      "name": "Â§©Ê∞ó‰∫àÂ†±API1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1238,
        1220
      ],
      "id": "0b8dd667-f0e6-4795-9daa-1a3d0f2f059b"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst today = data.forecasts[0];\nconst tomorrow = data.forecasts[1];\n\nconst message = `„Äê${data.location.city}„ÅÆÂ§©Ê∞ó‰∫àÂ†±„Äë\n\n‚ñ†‰ªäÊó•Ôºà${today.date}Ôºâ\nÂ§©Ê∞ó: ${today.telop}\nÊúÄÈ´òÊ∞óÊ∏©: ${today.temperature.max?.celsius || '‰∏çÊòé'}‚ÑÉ\nÊúÄ‰ΩéÊ∞óÊ∏©: ${today.temperature.min?.celsius || '‰∏çÊòé'}‚ÑÉ\n\n‚ñ†ÊòéÊó•Ôºà${tomorrow.date}Ôºâ\nÂ§©Ê∞ó: ${tomorrow.telop}\nÊúÄÈ´òÊ∞óÊ∏©: ${tomorrow.temperature.max?.celsius || '‰∏çÊòé'}‚ÑÉ\nÊúÄ‰ΩéÊ∞óÊ∏©: ${tomorrow.temperature.min?.celsius || '‰∏çÊòé'}‚ÑÉ\n\nË©≥Á¥∞: ${data.link}`;\n\nreturn {\n  json: {\n    location: data.location.city,\n    today_weather: today.telop,\n    today_temp_max: today.temperature.max?.celsius,\n    today_temp_min: today.temperature.min?.celsius,\n    tomorrow_weather: tomorrow.telop,\n    tomorrow_temp_max: tomorrow.temperature.max?.celsius,\n    tomorrow_temp_min: tomorrow.temperature.min?.celsius,\n    message: message,\n    link: data.link\n  }\n};"
      },
      "name": "Â§©Ê∞ó„Éá„Éº„ÇøÊï¥ÂΩ¢1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1536,
        1220
      ],
      "id": "a23d83cd-1bee-4f90-b9fd-3304901f4d6c"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\":  $json.message  \n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1756,
        1220
      ],
      "id": "30cfff35-aecf-4509-b67c-998569bd9e3b",
      "name": "List1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\":  $json.message  \n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1976,
        1620
      ],
      "id": "93897430-a5e3-4094-b9c8-441c6afec712",
      "name": "List2",
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://news.google.com/rss/search?q=AI+„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº+Ê†™‰æ°&hl=ja&gl=JP&ceid=JP:ja",
        "options": {}
      },
      "name": "Google News RSSÂèñÂæó1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1238,
        1620
      ],
      "id": "79f00138-6d0e-4957-8147-7c65fdba2f74",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "name": "XML Parse1",
      "type": "n8n-nodes-base.xml",
      "typeVersion": 1,
      "position": [
        1536,
        1620
      ],
      "id": "4b5071ed-850f-4f10-b835-4f7de171902c",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst rssData = items[0].json.rss.channel.item;\n\n// ÊúÄÊñ∞5‰ª∂„ÇíÂèñÂæó\nconst top5 = rssData.slice(0, 5);\n\n// LINE„É°„ÉÉ„Çª„Éº„Ç∏Áî®„Å´„Ç≥„É≥„Éë„ÇØ„Éà„Å´Êï¥ÂΩ¢Ôºà„Çø„Ç§„Éà„É´„Å®URL„ÅÆ„ÅøÔºâ\nconst newsText = 'üì∞ Êú¨Êó•„ÅÆÊ≥®ÁõÆ„Éã„É•„Éº„Çπ\\n\\n' + \n  top5.map((article, index) => \n    `${index + 1}. ${article.title}\\n${article.link}`\n  ).join('\\n\\n');\n\n// 1„Å§„ÅÆÂá∫Âäõ„Å´„Åæ„Å®„ÇÅ„Çã\nreturn [{\n  json: {\n    message: newsText,\n    newsCount: top5.length\n  }\n}];"
      },
      "name": "„Éã„É•„Éº„Çπ„Éá„Éº„ÇøÊï¥ÂΩ¢1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1756,
        1620
      ],
      "id": "c297348e-bbc5-4a57-8d89-20e205d11b8f",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// „É¶„Éº„Ç∂„Éº√óÂêçË®Ä ÁµêÂêà3 „Åã„ÇâÊù•„Åü items „Åã„Çâ\n// ÂÖàÈ†≠„ÅÆ1‰ª∂„Çí‰Ωø„Å£„Å¶„ÉÑ„Ç§„Éº„ÉàÁî®„ÉÜ„Ç≠„Çπ„Éà„Çí‰ΩúÊàê„Åô„Çã\n\nif (!items.length) {\n  return [];\n}\n\nconst { kakugen, jinbutsu } = items[0].json;\n\n// Â•Ω„Åç„Å™„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Å´Êï¥ÂΩ¢Ôºàjinbutsu„Å´„Éè„ÉÉ„Ç∑„É•„Çø„Ç∞„Çí‰ªò„Åë„ÇãÔºâ\nconst text = `„Äé${kakugen}„Äè\n‚îÄ ${jinbutsu}\\n\\n#${jinbutsu}`;\n\nreturn [\n  {\n    json: {\n      text,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1380,
        5900
      ],
      "id": "8adea4c7-5ae9-4941-bff5-d119e5a17581",
      "name": "Code2"
    },
    {
      "parameters": {
        "functionCode": "// Ë§áÊï∞„ÅÆÂêçË®Ä„Åã„Çâ„É©„É≥„ÉÄ„É†„Åß1‰ª∂„ÇíÈÅ∏Êäû\n// items „ÅØ [{json: {...}}, {json: {...}}, ...] „ÅÆÂΩ¢\nif (!items.length) {\n  return [];\n}\nconst picked = items[Math.floor(Math.random() * items.length)];\n// 1‰ª∂„Å†„Åë„ÇíËøî„Åô\nreturn [picked];"
      },
      "id": "b28bc752-449c-48fd-9d95-fe863575fd35",
      "name": "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1536,
        1820
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Á≠ã„Éà„É¨‰∏ÄË¶ß"
      },
      "id": "5f9db85f-d3d3-441c-94c5-a9bb5bf271bf",
      "name": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1238,
        1820
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": $json.ainote + \"\\n\" + $json.url  \n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1756,
        1820
      ],
      "id": "785f9ef9-5867-4fab-854a-a8ed66ec3d50",
      "name": "List4"
    },
    {
      "parameters": {
        "content": "‰ΩçÁΩÆÊÉÖÂ†±„ÅßÂ§©Ê∞ó‰∫àÂ†±",
        "height": 180,
        "width": 880,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1107,
        1600
      ],
      "typeVersion": 1,
      "id": "84b2daa4-c223-43ff-b258-d35838fd2044",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "functionCode": "const b = $json.body || $json;\nconst action = (b.action || '').trim();\nconst userId = (b.user_id || '').trim();\nconst taskId = b.task_id ?? null;\n\n// sort_update Áî®„Å´ orders „ÇÇÈÄö„Åô\nconst orders = Array.isArray(b.orders) ? b.orders : [];\n\nreturn [{\n  json: {\n    action,\n    user_id: userId,\n    task_id: taskId,\n\n    task_name: b.task_name || '',\n    priority: b.priority ?? 0,\n    vision_score: b.vision_score ?? 0,\n    excite_score: b.excite_score ?? 0,\n    growth_score: b.growth_score ?? 0,\n    orders,\n\n    // ‚òÖ‚òÖ ËøΩÂä†„Åì„Åì„Åã„Çâ ‚òÖ‚òÖ\n    kind: b.kind || '',\n    remind_at: b.remind_at || null,\n    // ‚òÖ‚òÖ ËøΩÂä†„Åì„Åì„Åæ„Åß ‚òÖ‚òÖ\n  }\n}];\n"
      },
      "id": "f4bb03f2-a0d0-4598-a378-c8cdd118e0d5",
      "name": "Parse & Validate",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        500,
        4080
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "create",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-create"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "create"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "delete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-delete"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "delete"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "complete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-complete"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "complete"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "uncomplete",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-uncomplete"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "uncomplete"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "toggle_pin",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-toggle-pin"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "toggle_pin"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "update_detail",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-update-detail"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "update_detail"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "remind_plus2h",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "rule-remind-plus2h"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "remind_plus2h"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9713aa48-5100-4d49-aea5-8e408504cc74",
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "sort_update",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sort_update"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4eaf278a-a791-4504-be23-d29f716d4d6b",
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "remind_custom",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "remind_custom"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": false
        }
      },
      "id": "11ebfc10-e8ee-4587-ac93-03de2a8e9654",
      "name": "Switch - action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        720,
        3954
      ]
    },
    {
      "parameters": {
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $json.user_id }}"
            },
            {
              "fieldId": "task_name",
              "fieldValue": "={{ $json.task_name }}"
            },
            {
              "fieldId": "complete_at",
              "fieldValue": "0"
            },
            {
              "fieldId": "pinned",
              "fieldValue": "0"
            },
            {
              "fieldId": "priority",
              "fieldValue": "={{ $json.priority }}"
            },
            {
              "fieldId": "vision_score",
              "fieldValue": "={{ $json.vision_score }}"
            },
            {
              "fieldId": "excite_score",
              "fieldValue": "={{ $json.excite_score }}"
            },
            {
              "fieldId": "growth_score",
              "fieldValue": "={{ $json.growth_score }}"
            }
          ]
        }
      },
      "id": "5310e739-4256-4b88-b5fe-c79a81dd787d",
      "name": "Supabase - Create Task",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        2880
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            },
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        }
      },
      "id": "2cb7503e-29fc-481a-a732-f3656c40c3c3",
      "name": "Supabase - Delete Task",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        3080
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            },
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "complete_at",
              "fieldValue": "0"
            }
          ]
        }
      },
      "id": "aabd2c68-8607-46da-a8a4-4cdbf91904d5",
      "name": "Supabase - Uncomplete Task",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        3480
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $json.task_id }}"
            },
            {
              "keyName": "user_id",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        }
      },
      "id": "f734646e-6e1f-4b5e-a71e-9191922ceef0",
      "name": "Supabase - Get Task",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        940,
        3780
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "pinned",
              "fieldValue": "=1"
            }
          ]
        }
      },
      "id": "1ca8ab55-eb92-48fd-89ae-4bafe47cf92f",
      "name": "Supabase - Toggle Pin",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        3680
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            },
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "priority",
              "fieldValue": "={{ $json.priority }}"
            },
            {
              "fieldId": "vision_score",
              "fieldValue": "={{ $json.vision_score }}"
            },
            {
              "fieldId": "excite_score",
              "fieldValue": "={{ $json.excite_score }}"
            },
            {
              "fieldId": "growth_score",
              "fieldValue": "={{ $json.growth_score }}"
            }
          ]
        }
      },
      "id": "269c3962-7ab3-4211-8ac5-2cf176cd0306",
      "name": "Supabase - Update Detail",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        4080
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "return [{ json: { ok: true, message: 'remind_plus2h stub' } }];"
      },
      "id": "fc565623-514e-4daf-991d-51ffa6688430",
      "name": "Stub - Remind Plus 2h",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1380,
        4280
      ]
    },
    {
      "parameters": {
        "functionCode": "return [{ json: { ok: false, message: `unknown action: ${$json.action}` } }];"
      },
      "id": "8945e4f0-5a99-4f0c-8b96-63e8c8c68722",
      "name": "Unknown Action",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1380,
        5230
      ],
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "77279b44-beb1-4b0f-a90b-cdf53401af6e",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2040,
        3900
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "action",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type"
              }
            ]
          }
        }
      },
      "id": "4f72170e-b9dc-4a1d-ab93-17b69b54aa62",
      "name": "Webhook - ACTION (POST)1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        280,
        4080
      ],
      "webhookId": "action-endpoint-id"
    },
    {
      "parameters": {
        "functionCode": "const rows = Array.isArray(items) ? items.map(i => i.json) : [];\n\nconst toTask = r => ({\n  id: r.id,\n  task_name: r.task_name || r.title || \"(ÁÑ°È°å)\",\n  pinned: Boolean(r.pinned),\n  priority: r.priority ?? 0,\n  vision_score: r.vision_score ?? 0,\n  excite_score: r.excite_score ?? 0,\n  growth_score: r.growth_score ?? 0,\n  complete_at: Number(r.complete_at) || 0,\n  sort_order: Number(r.sort_order) ?? 99999,\n  remind_at: r.remind_at || null, \n});\n\n// ÂàÜÈ°û\nconst pinned = [];\nconst active = [];\nconst completed = [];\n\nfor (const r of rows) {\n  const t = toTask(r);\n\n  if (t.pinned) {\n    pinned.push(t);\n  } else if (t.complete_at === 1) {\n    completed.push(t);\n  } else {\n    active.push(t);\n  }\n}\n\n// sort_order „Åß‰∏¶„ÅπÊõø„Åà\nconst bySort = (a, b) => (a.sort_order ?? 99999) - (b.sort_order ?? 99999);\n\npinned.sort(bySort);\nactive.sort(bySort);\ncompleted.sort(bySort);\n\nreturn [{ json: { pinned, active, completed } }];\n;"
      },
      "id": "a450ef6f-f678-44f5-898e-bd5b7378c007",
      "name": "Build OK6",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1820,
        3900
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json[\"task_id\"] }}"
            },
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json[\"user_id\"] }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "complete_at",
              "fieldValue": "1"
            }
          ]
        }
      },
      "id": "a9e36919-b327-4d70-ae1d-b4958be45b3c",
      "name": "Supabase - Complete Task1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        3280
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pinned }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "e20b9d2a-470b-4fa4-9d70-7d48cb10402c"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7368e2e6-0b97-45d6-bc32-c5f78e3b2bd2",
                    "leftValue": "={{ $json.pinned }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1160,
        3780
      ],
      "id": "d1445a3c-e477-4b5d-b7c0-507ae424c5f4",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "pinned",
              "fieldValue": "=0"
            }
          ]
        }
      },
      "id": "282de796-6060-4c05-969f-2d8a1525a236",
      "name": "Supabase - Toggle Pin1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        3880
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const orders = Array.isArray($json.orders) ? $json.orders : [];\nconst userId = $json.user_id;\n\nif (!userId || orders.length === 0) {\n  // ‰Ωï„ÇÇ„Å™„Åë„Çå„Å∞„Åù„ÅÆ„Åæ„ÅæËøî„Åó„Å¶„ÇÇOKÔºàBuild OK„Åß„Åù„ÅÆ„Åæ„Åæ200Ëøî„ÅôÊÉ≥ÂÆöÔºâ\n  return [{ json: { user_id: userId || null, orders: [], skipped: true } }];\n}\n\nreturn orders\n  .filter(o => o && o.id != null)\n  .map((o, idx) => ({\n    json: {\n      user_id: userId,\n      id: o.id,\n      sort_order: Number(o.sort_order ?? idx),\n      section: o.section || null\n    }\n  }));"
      },
      "id": "cce43c60-3146-48eb-ab48-79ea988afbae",
      "name": "Spread Orders",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1160,
        4680
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            },
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sort_order",
              "fieldValue": "={{ $json.sort_order }}"
            }
          ]
        }
      },
      "id": "b98cd995-e0cd-4b0b-811d-946374593018",
      "name": "Supabase - Update SortOrder",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        4680
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "7eudgpDWoCoIjWPb",
          "mode": "list",
          "cachedResultName": "Task Reminder"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1160,
        4880
      ],
      "id": "98e2abcc-66b7-45bf-a3af-5f20939ae2b0",
      "name": "Execute Workflow"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "remind_at",
              "fieldValue": "={{ $json.remind_at }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        940,
        4880
      ],
      "id": "e4be9152-ff45-45ce-ab7f-40c5a19103f0",
      "name": "Supabase1",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        940,
        4480
      ],
      "id": "88ebfab2-3d5b-47b3-82aa-40cd54a22b15",
      "name": "Wait",
      "webhookId": "0f70a475-9ef9-46a1-9b3b-60bce91f36ea"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.user_id }}"
            },
            {
              "name": "messages",
              "value": "={{ [ {\n  \"type\": \"text\",\n  \"text\": \"„É™„Éû„Ç§„É≥„Éâ„Å†„ÇàÔºÅüëá\\n„Äé\" + $json.task_name + \"„Äè\"\n} ] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "782919ea-d968-4418-8292-7b056c23f18c",
      "name": "LINEÈÄöÁü•ÈÄÅ‰ø°1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1380,
        4480
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            },
            {
              "keyName": "complete_at",
              "condition": "eq",
              "keyValue": "0"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id",
              "fieldValue": "={{ $json.task_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1160,
        4480
      ],
      "id": "5181cde3-edc7-4c8e-ad33-062849aeca7a",
      "name": "Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.task_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "remind_at",
              "fieldValue": "={{ $json.remind_at }}"
            }
          ]
        }
      },
      "id": "d8795ea3-5f25-4d84-a719-5ae26f348150",
      "name": "Supabase - Uncomplete Task1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1380,
        5030
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"‰ªäÊó•„ÅÆ„Éã„É•„Éº„Çπ„ÅØ„Åì„Å°„Çâ„Åã„ÇâÔºÅüíÅ‚Äç‚ôÇÔ∏è\\nhttps://newspicks.com/\"\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1238,
        1420
      ],
      "id": "3f2f513f-67e2-4210-b764-ceb24b30f7be",
      "name": "List5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"„Çπ„ÉÜ„Éº„Çø„Çπ„ÅØ„Åì„Å°„Çâ„Åã„Çâüëá\"\n  },\n  {\n    \"type\": \"text\",\n    \"text\": \"https://liff.line.me/2008544549-mDb15VqZ\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"uri\",\n            \"label\": \"„Çπ„ÉÜ„Éº„Çø„Çπ\",\n            \"uri\": \"https://liff.line.me/2008544549-mDb15VqZ\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1238,
        820
      ],
      "id": "5a682e44-3bbc-450a-b845-38392266c427",
      "name": "List3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"„Ç´„É¨„É≥„ÉÄ„Éº„ÅØ„Åì„Å°„Çâ„Åã„Çâüëá\"\n  },\n  {\n    \"type\": \"text\",\n    \"text\": \"https://calendar.google.com/calendar/u/0/r\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"uri\",\n            \"label\": \"„Ç´„É¨„É≥„ÉÄ„Éº\",\n            \"uri\": \"https://calendar.google.com/calendar/u/0/r\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1238,
        2020
      ],
      "id": "f98b6c97-1053-4d95-838d-acbce61f515b",
      "name": "List6"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "ÂêçË®ÄÈõÜ",
        "filters": {
          "conditions": [
            {
              "keyName": "sent_at",
              "condition": "eq",
              "keyValue": "1"
            }
          ]
        }
      },
      "id": "e477fab4-0168-4238-ab16-51589d8d7198",
      "name": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó2",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        6200
      ],
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f92bd6f1-6fcf-4a54-9524-affbe2b3cdf9",
              "name": "sent_at",
              "value": "={{ $json.sent_at }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        940,
        6200
      ],
      "id": "75a64eb5-13da-45e5-9625-0e99fc615d91",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "sent_at"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        1160,
        6200
      ],
      "id": "1227e818-8125-4278-83ee-ef4bcad99d5b",
      "name": "Summarize"
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1380,
        6150
      ],
      "id": "93a94043-429e-4a97-b6cd-db26e7a20c3e",
      "name": "Merge"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.count_sent_at % 10}}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "f79b2305-68b5-4dcc-bd94-62060c3753d2"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "10„ÅÆÂÄçÊï∞"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3a525e62-2ba6-499f-b051-68b9de0e2cf8",
                    "leftValue": "={{ $json.count_sent_at % 10}}",
                    "rightValue": 5,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "5„ÅÆÂÄçÊï∞"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1600,
        6150
      ],
      "id": "87582402-6ad5-4a8d-89ed-009fec7aa3f6",
      "name": "Switch2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "„ÅÇ„Å™„Åü„ÅØ„É†„Ç≠„É†„Ç≠„Çø„Çπ„Åè„Çì„Å®„ÅÑ„ÅÜÊòé„Çã„ÅèÂâçÂêë„Åç„Å™„Éë„Éº„ÇΩ„Éä„É´„Éà„É¨„Éº„Éä„Éº„Å®„Åó„Å¶Ë©±„Åô„ÄÇ\n‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨„ÇíÈÅîÊàê„Åó„Åü‰∫∫„Å´Âêë„Åë„Å¶„ÄÅ50Â≠óÁ®ãÂ∫¶„ÅÆÁü≠„ÅÑ„Å≠„Åé„Çâ„ÅÑ„ÅÆÊéõ„ÅëÂ£∞„Çí‰Ωú„Çã„Åì„Å®„ÄÇ\n„Éú„Éá„Ç£„Éì„É´Â§ß‰ºö„ÅÆ„Ç≥„Éº„É´„ÅÆ„Çà„ÅÜ„Å´„É¶„Éº„É¢„Ç¢„ÇíÂÖ•„Çå„Åü‰∏ÄË®Ä„Å´„Åô„Çã„ÄÇ\n‰æãÔºöÂõ∫ÂÆöË≥áÁî£Á®é„Åã„Åã„Å£„Å¶„Çã„Çà„ÄÅËÇ©„Å´„Å°„Å£„Å°„ÇÉ„ÅÑ„Ç∏„Éº„Éó‰πó„Åõ„Å¶„Çì„ÅÆ„Åã„ÅÑ Á≠â„ÄÇ\nÊéõ„ÅëÂ£∞„ÅØ1„Å§„Å†„ÅëËøî„Åô„ÄÇ\n„Åü„ÇÅÂè£„ÅßË©±„Åô„ÄÇ\nË®òÂè∑ ** „ÅØ‰Ωø„Çè„Åö„ÄÅ‚Äº„ÅØ‰Ωø„Å£„Å¶„Çà„ÅÑ„ÄÇ\nËá™ÂàÜ„ÅÆÂêçÂâç„ÅØÂêç‰πó„Çâ„Å™„ÅÑ„ÄÇ",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1160,
        2220
      ],
      "id": "293a70c2-c22a-4205-85f6-1ef61171d4f4",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1248,
        2440
      ],
      "id": "c0443645-5051-49d6-b8ee-095ea071af76",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "kF2BDLykZp4bVOlM",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "replyToken",
              "value": "={{ $('Code - Normalize LINE').item.json.replyToken }}"
            },
            {
              "name": "messages",
              "value": "={{ [ {\n  \"type\": \"text\",\n  \"text\": $json.text\n} ] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b5f55b94-a68b-48c8-9f64-642215a97ac3",
      "name": "LINEÈÄöÁü•ÈÄÅ‰ø°4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1540,
        2220
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"„É†„Ç≠„É†„Ç≠„Çø„Çπ„Åè„Çì„Å†„ÇàÔºÅüí™\\n\\n„Äé\" + $json.kakugen + \"„Äè\\n‚îÄ \" + $json.jinbutsu + \"\\n\\n„Åï„ÅÇ„ÄÅÊ∫ñÂÇô„ÅØ„ÅÑ„ÅÑ„ÅãÔºüüî•\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"message\",\n            \"label\": \"‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨ÂÆå‰∫Üüëç\",\n            \"text\": \"ÂÆå‰∫Üüëç\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1820,
        6250
      ],
      "id": "3f9f88dc-f20a-4e81-8cd9-e6faf54a9149",
      "name": "List11"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"‰ªäÊó•„Åß\" + $json.count_sent_at + \"Êó•ÁõÆ‚Äºüòé\\n\\n„Äé\" +  $json.kakugen  + \"„Äè\\n‚îÄ \" +  $json.jinbutsu   + \"\\n\\n„Åï„ÅÇ„ÄÅ„ÅÑ„Åì„ÅãÔºüüî•\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"message\",\n            \"label\": \"‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨ÂÆå‰∫Üüëç\",\n            \"text\": \"ÂÆå‰∫Üüëç\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1820,
        6050
      ],
      "id": "eb8927bb-51ff-48d0-998d-8c02c94d54f1",
      "name": "List12"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"type\": \"text\",\n    \"text\": \"Á¥†Êô¥„Çâ„Åó„ÅÑ‚Äº\" + $json.count_sent_at + \"Êó•ÈÅîÊàê‚Äºü•≥„Åì„Åì„Åæ„ÅßÁ∂ö„Åë„Çâ„Çå„Çã„ÅÆ„ÅØ„Åô„Åî„ÅÑ‚Äº\\n\\n„Äé\" +  $json.kakugen  + \"„Äè\\n‚îÄ \" +  $json.jinbutsu   + \"\\n\\n„Åï„ÅÇ„ÄÅ„ÇÇ„Å£„Å®È´ò„Åø„ÇíÁõÆÊåá„Åù„ÅÜüî•\",\n    \"quickReply\": {\n      \"items\": [\n        {\n          \"type\": \"action\",\n          \"action\": {\n            \"type\": \"message\",\n            \"label\": \"‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨ÂÆå‰∫Üüëç\",\n            \"text\": \"ÂÆå‰∫Üüëç\"\n          }\n        }\n      ]\n    }\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1820,
        5850
      ],
      "id": "8e1975a8-52f7-494f-9482-de1aa0bb1310",
      "name": "List13"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code - Normalize LINE",
            "type": "main",
            "index": 0
          },
          {
            "node": "Supabase Check User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Normalize LINE": {
      "main": [
        [
          {
            "node": "Set Agent Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Agent Input": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "List",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Journal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Â§©Ê∞ó‰∫àÂ†±API1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Google News RSSÂèñÂæó1",
            "type": "main",
            "index": 0
          },
          {
            "node": "List5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook - LIST (GET)": {
      "main": [
        [
          {
            "node": "Supabase: Select rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase: Select rows1": {
      "main": [
        [
          {
            "node": "Adapt ‚Üí {pinned,active,completed}1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adapt ‚Üí {pinned,active,completed}1": {
      "main": [
        [
          {
            "node": "Respond JSON1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Check User": {
      "main": [
        [
          {
            "node": "If New User?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If New User?": {
      "main": [
        [
          {
            "node": "Supabase Create User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû": {
      "main": [
        [
          {
            "node": "ÂêçË®Ä„ÇíÈÄÅ‰ø°Ê∏à„Åø„Å´Êõ¥Êñ∞1",
            "type": "main",
            "index": 0
          },
          {
            "node": "LINE„É¶„Éº„Ç∂„Éº‰∏ÄË¶ßÂèñÂæó1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó1": {
      "main": [
        [
          {
            "node": "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LINE„É¶„Éº„Ç∂„Éº‰∏ÄË¶ßÂèñÂæó1": {
      "main": [
        [
          {
            "node": "„É¶„Éº„Ç∂„Éº√óÂêçË®Ä ÁµêÂêà3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron - ÊØéÊó•22:30": {
      "main": [
        [
          {
            "node": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó1",
            "type": "main",
            "index": 0
          },
          {
            "node": "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "„É¶„Éº„Ç∂„Éº√óÂêçË®Ä ÁµêÂêà3": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Â§©Ê∞ó‰∫àÂ†±API1": {
      "main": [
        [
          {
            "node": "Â§©Ê∞ó„Éá„Éº„ÇøÊï¥ÂΩ¢1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Â§©Ê∞ó„Éá„Éº„ÇøÊï¥ÂΩ¢1": {
      "main": [
        [
          {
            "node": "List1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google News RSSÂèñÂæó1": {
      "main": [
        [
          {
            "node": "XML Parse1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "XML Parse1": {
      "main": [
        [
          {
            "node": "„Éã„É•„Éº„Çπ„Éá„Éº„ÇøÊï¥ÂΩ¢1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "„Éã„É•„Éº„Çπ„Éá„Éº„ÇøÊï¥ÂΩ¢1": {
      "main": [
        [
          {
            "node": "List2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Create Tweet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû1": {
      "main": [
        [
          {
            "node": "List4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó": {
      "main": [
        [
          {
            "node": "ÂêçË®Ä1‰ª∂„Å†„ÅëÈÅ∏Êäû1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse & Validate": {
      "main": [
        [
          {
            "node": "Switch - action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch - action": {
      "main": [
        [
          {
            "node": "Supabase - Create Task",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Delete Task",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Complete Task1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Uncomplete Task",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Get Task",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Update Detail",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stub - Remind Plus 2h",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Spread Orders",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Supabase - Uncomplete Task1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Create Task": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Delete Task": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Uncomplete Task": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Get Task": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Toggle Pin": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Update Detail": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Stub - Remind Plus 2h": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unknown Action": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook - ACTION (POST)1": {
      "main": [
        [
          {
            "node": "Parse & Validate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build OK6": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Complete Task1": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Supabase - Toggle Pin",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase - Toggle Pin1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Toggle Pin1": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Spread Orders": {
      "main": [
        [
          {
            "node": "Supabase - Update SortOrder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Update SortOrder": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow": {
      "main": [
        []
      ]
    },
    "Supabase1": {
      "main": [
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "LINEÈÄöÁü•ÈÄÅ‰ø°1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Uncomplete Task1": {
      "main": [
        [
          {
            "node": "Build OK6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‰ªäÊó•„ÅÆÂêçË®ÄÂèñÂæó2": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "List13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "List11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "LINEÈÄöÁü•ÈÄÅ‰ø°4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "77d31c6417b7f4a97ff32b52b2f93e93f53e0a0f52d46951827b8caaa26002b2"
  }
}



{
  "nodes": [
    {
      "parameters": {
        "resume": "specificTime",
        "dateTime": "={{ $json.remind_at }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        620,
        40
      ],
      "id": "abee861e-c735-46b1-b6da-7221ed3b12f3",
      "name": "Wait",
      "webhookId": "0f70a475-9ef9-46a1-9b3b-60bce91f36ea"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer m+vt4JTVz5nC9grUAfL7nZg56123rt0NXoOJ1m6O5e79nCuLrYgUzxGYc+pWxUHU6qyNVFY90x8JO2QnkybyendzkFmSlfDah/piEIa++P/KNa2nfrPHmB4RlrguRJ1ft6Qoxz6pQchWPGL0FuXztAdB04t89/1O/w1cDnyilFU=\",\n  \"Content-Type\": \"application/json\"\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.user_id }}"
            },
            {
              "name": "messages",
              "value": "={{ [ {\n  \"type\": \"text\",\n  \"text\": \"üëá„É™„Éû„Ç§„É≥„Éâ„Å†„ÇàÔºÅ\\n„Äé\" + $json.task_name + \"„Äè\"\n} ] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "19394566-1574-4592-a358-7735291e53e5",
      "name": "LINEÈÄöÁü•ÈÄÅ‰ø°1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1500,
        40
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "„Çø„Çπ„ÇØ‰∏ÄË¶ß",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        840,
        40
      ],
      "id": "32eb321d-3629-4965-a205-fa9cd24fd160",
      "name": "Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "tLBH1Fj0NZ4rIzKG",
          "name": "yamasho-supabase"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -40,
        40
      ],
      "id": "5f07d418-beb8-4049-a8db-5ec44ff1347a",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4b47b621-0e4f-4dec-8521-25dd0a1aee67",
              "leftValue": "={{ $json.complete_at }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "ad3940ce-90bd-4cdc-bc4e-e9190135276f",
              "leftValue": "={{ $json.pinned }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1280,
        40
      ],
      "id": "8447ef07-ad5f-4cda-abb7-b3c01bd2a43d",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "86df5c5f-6611-4ae3-ac1d-3d05219fb375",
              "leftValue": "={{ $json.remind_at}}",
              "rightValue": "[null]",
              "operator": {
                "type": "dateTime",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        180,
        40
      ],
      "id": "74e04fac-50d1-4688-8d89-1665c6bd1671",
      "name": "If1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ new Date().toISOString() }}",
                    "rightValue": "={{ $json.remind_at }}",
                    "operator": {
                      "type": "dateTime",
                      "operation": "before"
                    },
                    "id": "07229099-9327-4859-aafa-fe3e6268c6b2"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": false
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        400,
        40
      ],
      "id": "f84589bf-c3b9-4275-8ccb-ec605910e13e",
      "name": "Switch"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6b5ceba4-10ac-4403-8f08-13c9eb89a21e",
              "leftValue": "={{ $json.remind_at }}",
              "rightValue": "={{ $('Wait').item.json.remind_at }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1060,
        40
      ],
      "id": "42d0b491-27f7-492d-b502-26fa87bab86a",
      "name": "If2"
    }
  ],
  "connections": {
    "Wait": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "LINEÈÄöÁü•ÈÄÅ‰ø°1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "77d31c6417b7f4a97ff32b52b2f93e93f53e0a0f52d46951827b8caaa26002b2"
  }
}
